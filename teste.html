<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Eleva TV - Slide Ajustado</title>
<style>
    /* Reset */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    /* Fundo preto ajuda caso o slide fique com bordas laterais ao redimensionar */
    html, body { width: 100%; height: 100%; background: #000; font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; overflow: hidden; }

    /* --- IFRAME (apresentação) --- */
    .presentation-frame {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        /* AQUI ESTÁ O AJUSTE: */
        height: 87%; /* Reduzi de 100% para 87% para não bater na barra */
        border: 0;
        z-index: 1;
    }

    /* --- BARRA LARANJA --- */
    .info-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 13%; /* Ocupa exatamente o espaço que tiramos do slide */
        min-height: 80px;
        z-index: 20;
        background-color: #ff8e03; 
        display: flex;
        align-items: center;
        justify-content: space-between; 
        padding: 0 2rem;
        box-shadow: 0 -4px 12px rgba(0,0,0,0.35);
    }

    /* ESQUERDA (Logo | Data) */
    .left-group { display: flex; align-items: center; height: 100%; flex: 0 0 auto; z-index: 25; background-color: #ff8e03; }

    .logo-box {
        background: #ffffff;
        border-radius: 12px;
        height: 70%; 
        aspect-ratio: 1 / 1; 
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
        margin-right: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .logo-box img { max-width: 100%; max-height: 100%; object-fit: contain; }

    .vertical-divider { width: 1px; height: 60%; background-color: rgba(255,255,255,0.4); margin-right: 20px; }

    .date-display { display: flex; flex-direction: column; justify-content: center; color: #fff; padding-right: 15px;}
    .day-line { font-size: 3.5vh; font-weight: 800; line-height: 1.1; text-transform: capitalize; }
    .date-line { font-size: 2vh; font-weight: 400; opacity: 0.9; }

    /* CENTRO (LETREIRO) */
    .marquee-container {
        flex: 1; 
        height: 100%;
        overflow: hidden; 
        position: relative;
        display: flex;
        align-items: center;
        mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
        -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent);
    }

    .marquee-content {
        position: absolute;
        white-space: nowrap; 
        will-change: transform;
        color: #fff;
        font-size: 3.2vh; 
        font-weight: 600;
    }

    .separator {
        color: rgba(255,255,255,0.6);
        margin: 0 25px; 
        font-weight: 300;
        font-size: 0.8em;
    }

    /* DIREITA (Clima | Hora) */
    .right-group { display: flex; align-items: center; height: 100%; flex: 0 0 auto; z-index: 25; background-color: #ff8e03; padding-left: 15px; }

    .weather-container { display: flex; align-items: center; margin-right: 20px; }
    .weather-icon-box { background: transparent; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
    .weather-icon-box img { width: 45px; height: 45px; filter: brightness(0) invert(1); } 

    .weather-text { text-align: left; color: #fff; }
    .weather-temp { font-size: 3.8vh; font-weight: 800; line-height: 1; }
    .weather-city { font-size: 1.6vh; font-weight: 600; margin-top: 2px; opacity: 0.95; }

    .time-display {
        color: #fff;
        font-size: 5.5vh;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
        line-height: 1;
        margin-left: 20px; 
    }

    @keyframes scrollLeft {
        0% { transform: translateX(100%); } 
        100% { transform: translateX(-100%); } 
    }

</style>
</head>
<body>

    <iframe id="slide-frame" class="presentation-frame" src="" allowfullscreen mozallowfullscreen webkitallowfullscreen></iframe>

    <div class="info-bar">
        <div class="left-group">
            <div class="logo-box">
                <img src="https://d24d7vsshzrslo.cloudfront.net/sites/school10/files/2022-09/logo_escola_eleva.png" alt="Logo">
            </div>
            <div class="vertical-divider"></div>
            <div class="date-display">
                <div id="day-line" class="day-line">Carregando...</div>
                <div id="date-line" class="date-line">...</div>
            </div>
        </div>

        <div class="marquee-container" id="marquee-container">
            <div id="marquee-text" class="marquee-content">
                Carregando Notícias...
            </div>
        </div>

        <div class="right-group">
            <div class="weather-container">
                <div class="weather-icon-box">
                    <img id="weather-icon-img" src="https://cdn-icons-png.flaticon.com/512/869/869869.png" alt="Icone">
                </div>
                <div class="weather-text">
                    <div class="weather-temp" id="weather-temp">--°C</div>
                    <div class="weather-city">Rio de Janeiro – RJ</div>
                </div>
            </div>
            <div class="vertical-divider"></div>
            <div class="time-display" id="time-container">--:--:--</div>
        </div>
    </div>

<script>
    // ==========================================
    // CONFIGURAÇÕES
    // ==========================================
    const TEMPO_ROLAGEM = 25; 
    const SHEET_ID = '1CZ0NkBomU3prL1EmSk_baavwJRQySmjzRTf0HdLPMvo'; 
    // ==========================================

    function getQueryParam(param, def){
        const p = new URLSearchParams(window.location.search);
        return p.get(param) || def;
    }
    const defaultSlideUrl = "https://docs.google.com/presentation/d/1DGoAjEoJlrCjzNGgVUDsi8ehTzpwxPJbt6-muG5Ry3k/embed?start=true&loop=true&rm=minimal&delayms=60000";
    const slideUrl = getQueryParam('embed', defaultSlideUrl);
    const refreshInterval = parseInt(getQueryParam('refresh','3600000'),10);

    document.getElementById('slide-frame').src = slideUrl;

    // --- 1. CLOCK & DATE ---
    function formatDiaSemana(diaBruto){
        return diaBruto.toLowerCase().split('-').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join('-');
    }
    function updateClockAndDate(){
        const TIMEZONE = 'America/Sao_Paulo';
        const now = new Date();
        let rawDay = new Intl.DateTimeFormat('pt-BR',{weekday:'long',timeZone:TIMEZONE}).format(now);
        const dayFormatted = formatDiaSemana(rawDay);
        const dateRest = new Intl.DateTimeFormat('pt-BR',{year:'numeric', month:'long', day:'numeric', timeZone:TIMEZONE}).format(now);
        const timeString = now.toLocaleTimeString('pt-BR',{hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:TIMEZONE});
        document.getElementById('day-line').textContent = dayFormatted;
        document.getElementById('date-line').textContent = dateRest;
        document.getElementById('time-container').textContent = timeString;
    }
    setInterval(updateClockAndDate, 1000);
    updateClockAndDate();

    // --- 2. WEATHER (Rio) ---
    const RIO_COORDS = { lat:-22.9068, lon:-43.1729, tz:"America/Sao_Paulo" };
    function getWeatherIconURL(code) {
        if (code === 0) return "https://cdn-icons-png.flaticon.com/512/869/869869.png";
        if (code >= 1 && code <= 3) return "https://cdn-icons-png.flaticon.com/512/1163/1163624.png";
        if (code === 45 || code === 48) return "https://cdn-icons-png.flaticon.com/512/4151/4151022.png";
        if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) return "https://cdn-icons-png.flaticon.com/512/3351/3351979.png";
        if (code >= 95) return "https://cdn-icons-png.flaticon.com/512/1146/1146860.png";
        return "https://cdn-icons-png.flaticon.com/512/869/869869.png";
    }
    async function fetchRioWeather(){
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${RIO_COORDS.lat}&longitude=${RIO_COORDS.lon}&current_weather=true&timezone=${RIO_COORDS.tz}`;
        try {
            const res = await fetch(url);
            if(!res.ok) throw new Error("API Error");
            const data = await res.json();
            const w = data.current_weather;
            document.getElementById('weather-temp').textContent = Math.round(w.temperature) + "°C";
            document.getElementById('weather-icon-img').src = getWeatherIconURL(w.weathercode);
        } catch(err){ console.error("Erro clima:", err); }
    }
    fetchRioWeather();
    setInterval(fetchRioWeather, 600000); 

    // --- 3. GOOGLE SHEETS NEWS (Smart Refresh) ---
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
    const marqueeElement = document.getElementById('marquee-text');
    let lastFetchedContent = "";

    async function fetchNews() {
        try {
            const noCacheUrl = `${SHEET_URL}&t=${new Date().getTime()}`;
            const response = await fetch(noCacheUrl);
            const text = await response.text();
            
            const lines = text.split('\n');
            const newsItems = [];

            for(let i = 1; i < lines.length; i++) {
                let line = lines[i].trim();
                if(line.startsWith('"') && line.endsWith('"')) line = line.substring(1, line.length - 1);
                line = line.replace(/""/g, '"');
                if(line.length > 0) newsItems.push(line);
            }

            if(newsItems.length === 0) newsItems.push("Bem-vindo à Escola Eleva");
            const newContentString = newsItems.join("###SEP###");

            if (newContentString !== lastFetchedContent) {
                lastFetchedContent = newContentString;
                updateMarquee(newsItems);
            }
        } catch (error) { console.error("Erro planilha:", error); }
    }

    function updateMarquee(items) {
        const separatorHtml = '<span class="separator">|</span>';
        const fullText = items.join(separatorHtml);
        marqueeElement.innerHTML = fullText;
        marqueeElement.style.animation = 'none';
        marqueeElement.offsetHeight; 
        marqueeElement.style.animation = `scrollLeft ${TEMPO_ROLAGEM}s linear infinite`;
    }

    fetchNews(); 
    setInterval(fetchNews, 3000); 

    // --- Reloads ---
    setInterval(()=>{ document.getElementById('slide-frame').src = slideUrl; }, refreshInterval);
    setTimeout(()=>{ window.location.reload(true); }, 86400000);

</script>
</body>
</html>